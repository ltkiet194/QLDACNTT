@model IEnumerable<GameStore.Models.DTO.Games>


@{
    ViewBag.Title = "QLGames";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<h1 style="text-align:center;">Danh sách game</h1>

<p>
        @Html.ActionLink("Create New", "Create")
    </p>

<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Name)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.ImgName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.PriceGame)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.YearRelease)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.NumSale)
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr id="@item.Id" data-name="@item.Name">

            <td>
                @Html.DisplayFor(modelItem => item.Name)
            </td>
            <td>
                @if (!string.IsNullOrEmpty(item.ImgName))
                {

                    <a href="#" class="avatar rounded-circle mr-3" >
                        <img alt="Image placeholder" src="~/Theme/images/ImageResource/@item.ImgName">
                    </a>
                }

            </td>
            <td>
                @Html.DisplayFor(modelItem => item.PriceGame)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.YearRelease)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.NumSale)
            </td>
            <td>
                @Html.ActionLink("Edit", "Edit", new { id = item.Id }, new { @class = "link-button edit" })

                @Html.ActionLink("Delete", "Delete", new { id = item.Id }, new { @class = "link-button delete" })
                @Html.ActionLink("Manage", "Manage", new { id = item.Id }, new { @class = "link-button manage" })
            </td>

        </tr>
    }

</table>

<div style="display:none;" class="modal" id="deleteModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="text-align:center;" class="modal-title">Bạn có thực sự muốn xóa game này?</h2>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-danger" id="confirmDelete">Xóa</button>
            </div>
        </div>
    </div>
</div>

<div class="pagination">
    @if (ViewBag.TotalPages > 1)  // Kiểm tra nếu có nhiều hơn 1 trang
    {
        if (ViewBag.CurrentPage <= 3)
        {
            // Hiển thị 5 trang đầu
            for (int i = 1; i <= 5; i++)
            {
                if (i == ViewBag.CurrentPage)
                {
                    <span>@i</span>
                }
                else
                {
                    <a href="@Url.Action("QLGames", new { page = i })">@i</a>
                }
            }
            // Hiển thị dấu chấm gián đoạn
            <span>...</span>
            // Hiển thị trang cuối
            <a href="@Url.Action("QLGames", new { page = ViewBag.TotalPages })">@ViewBag.TotalPages</a>
        }
        else if (ViewBag.CurrentPage > ViewBag.TotalPages - 3)
        {
            // Hiển thị trang đầu
            <a href="@Url.Action("QLGames", new { page = 1 })">1</a>
            // Hiển thị dấu chấm gián đoạn
            <span>...</span>
            // Hiển thị 5 trang cuối
            for (int i = ViewBag.TotalPages - 4; i <= ViewBag.TotalPages; i++)
            {
                if (i == ViewBag.CurrentPage)
                {
                    <span>@i</span>
                }
                else
                {
                    <a href="@Url.Action("QLGames", new { page = i })">@i</a>
                }
            }
        }
        else
        {
            // Hiển thị trang đầu
            <a href="@Url.Action("QLGames", new { page = 1 })">1</a>
            // Hiển thị dấu chấm gián đoạn
            <span>...</span>
            // Hiển thị 3 trang trước và sau trang hiện tại
            for (int i = ViewBag.CurrentPage - 2; i <= ViewBag.CurrentPage + 2; i++)
            {
                if (i == ViewBag.CurrentPage)
                {
                    <span>@i</span>
                }
                else
                {
                    <a href="@Url.Action("QLGames", new { page = i })">@i</a>
                }
            }
            // Hiển thị dấu chấm gián đoạn
            <span>...</span>
            // Hiển thị trang cuối
            <a href="@Url.Action("QLGames", new { page = ViewBag.TotalPages })">@ViewBag.TotalPages</a>
        }
    }
</div>
<style>
    .pagination {
        display: flex;
        justify-content: center;
        margin: 10px 0;
    }

        .pagination a, .pagination span {
            margin: 2px;
            padding: 5px 10px;
            text-decoration: none;
            border: 1px solid #ccc;
            color: #333;
            border-radius: 5px;
        }

            .pagination a:hover {
                background-color: #f2f2f2;
            }

        .pagination .active-page {
            background-color: #007bff;
            color: #fff;
        }
    /* Các nút nhấn cho các liên kết "Edit," "Details," và "Delete" */
    .link-button {
        display: inline-block;
        padding: 5px 10px;
        margin-right: 5px;
        text-decoration: none;
        color: #fff;
        border-radius: 5px;
    }

        .link-button.edit {
            background-color: #007bff;
        }

        .link-button.details {
            background-color: #28a745;
        }

        .link-button.delete {
            background-color: #dc3545;
        }

        .link-button.manage {
            background-color: #ffd800;
        }
    /* CSS cho modal */
    

   


    .modal-table {
        width: 100%;
        border-collapse: collapse; /* Loại bỏ khoảng cách giữa các ô */
    }

        .modal-table th,
        .modal-table td {
            padding: 8px;
            border: 1px solid #ddd; /* Thiết lập border cho các ô */
        }

        .modal-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        

        /* Giới hạn kích thước và tạo thanh cuộn cho ô input */
        .modal-table input[type="text"] {
            width: 100%;
            max-width: 200px; /* Điều chỉnh kích thước tối đa của ô input */
            overflow-x: auto;
        }
    input[type="text"]:focus {
        outline: none;
        border-color: none;
        
    }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('.pagination .page-number').on('click', function () {
            $('.pagination .active-page').removeClass('active-page');
            $(this).addClass('active-page');
        });
    });
</script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
<script>
    $(document).ready(function () {
        // Khi click vào nút "Delete"
        $('.delete').on('click', function (e) {
            e.preventDefault(); // Ngăn chặn chuyển hướng đến trang Delete
            // Lấy giá trị thuộc tính "data_id" từ nút "Delete" được nhấn
            var itemId = $(this).closest('tr').attr('id');

            // Mở modal
            $('#deleteModal').modal('show');

            // Khi click vào nút "Xóa" trong modal
            $('#confirmDelete').on('click', function () {
                $.ajax({
                    url: '/Admin/QLGame/Delete',
                    type: 'POST',
                    data: { id: itemId },
                    success: function (response) {
                        if (response.success === true) {
                            $('#deleteModal').modal('hide');
                            toastr.success('Xóa thành công!', 'Thành công');
                            setTimeout(function () {
                                location.reload();

                            }, 1500);
                        } else {
                            toastr.error(response.message, 'Lỗi');
                        }
                    },
                    error: function () {
                        toastr.error('Đã xảy ra lỗi. Vui lòng thử lại.', 'Lỗi');
                    }
                });
            });
        });
    });
    $(document).ready(function () {
        // Khi click vào nút "Manage"
        $('.manage').on('click', function (e) {
            e.preventDefault(); // Ngăn chặn chuyển hướng đến trang Manage
            var nameGameValue = $(this).closest('tr').attr('data-name');
            var itemId = $(this).closest('tr').attr('id');
 
            $('#TenGame').text(nameGameValue);
            
            getsp(itemId)
            // Mở modal
            $('#UpdateKhoModal').modal('show');
            $('#UpdateKhoModal').on('hide.bs.modal', function () {
                $('#saveKho').off('click');
            });
            $('#saveKho').on('click', function () {
                var soluongconlai = $("#SLCL").val()
                $.ajax({
                    url: '/Admin/QLGame/EditManage',
                    type: 'POST',
                    data: { id: itemId, soluongconlai: soluongconlai },
                    success: function (response) {
                        if (response.success === true) {
                           
                            toastr.success(response.message, 'Thành công');
                            setTimeout(function () {
                                location.reload();

                            }, 1500);
                        } else {
                            toastr.error(response.message, 'Lỗi');
                        }
                    },
                    error: function () {
                        toastr.error('Đã xảy ra lỗi. Vui lòng thử lại.', 'Lỗi');
                    }
                });
            });
        });

    });
    function getsp(id) {
        $.ajax({
            url: '/Admin/QLGame/GetManage',
            type: 'POST',
            data: { id: id },
            success: function (response) {
                if (response.success === true) {
                    $("#SLDB").text(response.getsp.SoLuongDaBan)
                    $("#SLCL").val(response.getsp.SoLuongConLai)
                } else {
                    toastr.error(response.message, 'Lỗi');
                }
            },
            error: function () {
                toastr.error('Đã xảy ra lỗi. Vui lòng thử lại.', 'Lỗi');
            }
        });
    }
</script>

<div class="modal fade" id="UpdateKhoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="exampleModalLongTitle">Quản lý kho</h2>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table class="modal-table">
                    <thead>
                        <tr>
                            
                            <th>Tên sản phẩm</th>
                            <th>Số lượng đã bán</th>
                            <th>Số lượng còn lại</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                           
                            <td>
                                <label id="TenGame"></label>
                            </td>
                            <td>
                                <label id="SLDB"></label>
                            </td>
                            <td>
                                <input type="number" id="SLCL"/>
                            </td>
                        </tr>       
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveKho">Cập nhật</button>
            </div>
        </div>
    </div>
</div>
